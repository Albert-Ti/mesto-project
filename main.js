(()=>{"use strict";var e,t=function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.removeAttribute("disabled")):(t.classList.add(n.inactiveButtonClass),t.setAttribute("disabled",!0))};e={formSelector:".form",inputSelector:".form__place",submitButtonSelector:".form__button",inactiveButtonClass:"form__button_inactive",errorClass:"form__place_active-error"},Array.from(document.querySelectorAll(e.formSelector)).forEach((function(n){!function(e,n){var o=Array.from(e.querySelectorAll(n.inputSelector)),r=e.querySelector(n.submitButtonSelector);t(o,r,n),o.forEach((function(c){c.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.errorClass),o.textContent=""}(e,t,n):function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.errorClass),r.textContent=o}(e,t,n,t.validationMessage)}(e,c,n),t(o,r,n)}))})),e.addEventListener("reset",(function(){setTimeout((function(){t(o,r,n)}),0)}))}(n,e)}));var n=document.querySelectorAll(".popup");function o(e){e.classList.add("popup_opened"),document.addEventListener("keydown",r)}function r(e){"Escape"===e.key&&n.forEach(c)}function c(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",r)}var a=document.querySelector(".profile__name"),u=document.querySelector(".profile__text"),i=document.querySelector('[name="username"]'),s=document.querySelector('[name="about-me"]'),l=document.querySelector(".popup-card"),d=document.querySelector(".popup-profile"),m=document.querySelector(".popup-avatar");document.querySelector(".profile__avatar").addEventListener("click",(function(){return o(m)})),document.querySelector(".profile__edit-name-button").addEventListener("click",(function(){return o(d)})),document.querySelector(".profile__button").addEventListener("click",(function(){return o(l)}));var f={authorization:"1bdbc94b-6239-4b7b-83a9-133ed323b1e4","Content-Type":"application/json"},p=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))},v=function(e){e&&document.querySelectorAll(".form__button").forEach((function(e){return e.textContent="Сохранение..."}))};fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{headers:f}).then(p).then((function(e){return e.forEach(E)})).catch((function(e){return console.error(e)}));var _=document.querySelector(".elements"),h=document.querySelector(".popup-img"),y=document.querySelector(".modal__open-img"),S=document.querySelector(".modal__text"),q=document.querySelector('[name="url"]'),b=document.querySelector('[name="cardname"]'),E=function(e){if("209313a7808b04f182624032"===e.owner._id){var t=L(e);t.querySelector(".element__remove").style.display="block",_.append(t)}else{var n=L(e);_.append(n)}},L=function(e){var t=document.querySelector("#template-card").content.querySelector(".element").cloneNode(!0),n=t.querySelector(".element__like"),r=t.querySelector(".element__image"),c=t.querySelector(".element__likes");return 0===e.likes.length?c.textContent="":c.textContent="".concat(e.likes.length),t.querySelector(".element__title").textContent=e.name,r.setAttribute("src",e.link),r.setAttribute("alt","Картинка ".concat(e.name)),r.addEventListener("click",(function(){S.textContent=e.name,y.setAttribute("src",e.link),y.setAttribute("alt","Картинка ".concat(e.name)),o(h)})),e.likes.forEach((function(e){"209313a7808b04f182624032"===e._id?n.classList.add("element__like_active"):n.classList.remove("element__like_active")})),n.addEventListener("click",(function(){var t;n.classList.contains("element__like_active")?function(e){fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(e),{method:"DELETE",headers:f})}(e._id):(t=e._id,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/likes/".concat(t),{method:"PUT",headers:f})),setTimeout((function(){return location.reload()}),100)})),t.querySelector(".element__remove").addEventListener("click",(function(){var n;t.closest(".element").remove(),n=e._id,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards/".concat(n),{method:"DELETE",headers:f})})),t};document.forms["avatar-form"].addEventListener("submit",(function(e){var t;e.preventDefault(),v(!0),document.querySelector(".profile__avatar-img").src=m.querySelector('[name="avatar"]').value,t=m.querySelector('[name="avatar"]').value,fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me/avatar",{method:"PATCH",headers:f,body:JSON.stringify({avatar:t})}).then(p).catch((function(e){return console.error(e)})).finally((function(){return v(!1)})),c(m),e.target.reset()})),document.forms["card-form"].addEventListener("submit",(function(e){var t,n;e.preventDefault(),v(!0),t=b.value,n=q.value,fetch("https://nomoreparties.co/v1/plus-cohort-21/cards",{method:"POST",headers:f,body:JSON.stringify({name:t,link:n})}).then(p).then(E).catch((function(e){return console.error(e)})).finally((function(){return v(!1)})),c(l),e.target.reset(),setTimeout((function(){return location.reload()}),500)})),n.forEach((function(e){e.addEventListener("mousedown",(function(t){t.target.classList.contains("popup_opened")&&c(e),t.target.classList.contains("popup__close")&&c(e)}))})),document.forms["profile-form"].addEventListener("submit",(function(e){var t,n;e.preventDefault(),v(!0),a.textContent="".concat(i.value),u.textContent="".concat(s.value),t=a.textContent,n=u.textContent,fetch("https://nomoreparties.co/v1/plus-cohort-21/users/me",{method:"PATCH",headers:f,body:JSON.stringify({name:t,about:n})}).then(p).then((function(e){return a.textContent=t,u.textContent=n,e})).catch((function(e){return console.error(e)})).finally((function(){return v(!1)})),c(d)}))})();